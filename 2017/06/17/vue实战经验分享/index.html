









<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            <div class="post-head-wrapper"
                 style="background-image: url('/2017/06/17/vue实战经验分享/logo.png')">
                <div class="post-title">
                    Vue实战经验分享
                    <div class="post-meta">
                        <time datetime="2017-06-17T20:57:11.000Z" itemprop="datePublished">
                            2017-06-17 20:57
                        </time>&nbsp;
                        
                        
                        <i class="material-icons" style="">folder</i>
                        
                        <a href='/categories/Vue/'>Vue</a>
                        
                        
    
                        
                        
                        <i class="material-icons" style="">label</i>
                        
                        <a href='/tags/Vue/'>Vue</a>
                        
                        
                    </div>
                </div>
            </div>
    
            <div class="post-body-wrapper">
                <div class="post-body">
                    <!-- no node -->

<span id="more"></span>

<blockquote>
<p>这周接到了一个SPA的活动页，借着这次机会直接在单位用起了Vue框架。<br>因为之前自己练习过几个小Demo，所以对一些API还是能够比较熟悉的使用，不用直接操纵DOM的感觉真的是很棒的。<br>当然在使用框架的时候，不能忘了“初心”。记住必要<strong>探其究竟</strong>。<br>这两周没有经常更新Github，但是我一直活跃，我关注新技术，我仍然在这条路上。<br>那么下面来说说我在这个SPA活动页项目中踩到的坑吧。</p>
</blockquote>
<h2 id="Build生成的文件如何与后端配合"><a href="#Build生成的文件如何与后端配合" class="headerlink" title="Build生成的文件如何与后端配合"></a>Build生成的文件如何与后端配合</h2><p>目前我单位的工作模式是前后端分离的。</p>
<p>之前我一直认为使用<code>npm run build</code>生成的文件，需要使用<code>node</code>起一个服务来进行使用。</p>
<p>但是并不是这样的，生成的文件丢到服务器后，可以直接配置<code>Apache</code>和<code>Tomcat</code>的配置文件，来引导<code>css</code>和<code>js</code>文件的相对路径。</p>
<p>那么是怎么发现这个问题的呢，这里很有意思，把文件直接丢上服务器，发现<code>css</code>和<code>js</code>文件的相对路径有问题，导致<code>index.html</code>没有办法正确的加载这些文件，所以导致显示内容空白。</p>
<p>那么虽然我不是一个后端，但是我简单的了解了下和这个问题的相关的内容。</p>
<p>下面直接上配置：</p>
<h3 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h3><p>配置<code>httpd.conf</code>文件<code>DocumentRoot</code>的引导路径即可。</p>
<h3 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h3><p>Build生成的文件目录在<code>dist</code>下，那么这里以<code>dist</code>为例。我们把<code>dist</code>目录丢到<code>webapps</code>下，然后配置<code>conf/server.xml</code>：</p>
<pre class="line-numbers language-xml"><code class="language-xml">
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Host</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>localhost<span class="token punctuation">"</span></span> <span class="token attr-name">appBase</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>webapps/dist<span class="token punctuation">"</span></span> <span class="token attr-name">unpackWARs</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">autoDeploy</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

    &lt;Valve className="org.apache.catalina.valves.AccessLogValve" directory="logs" 
    prefix="localhost_access_log." suffix=".txt" 
    pattern="%h %l %u %t "%r" %s %b"/>  
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Context</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/dist<span class="token punctuation">"</span></span> <span class="token attr-name">reloadable</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">docBase</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/home/tomcat/webapps/dist<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Host</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Build生成的文件去掉map文件"><a href="#Build生成的文件去掉map文件" class="headerlink" title="Build生成的文件去掉map文件"></a>Build生成的文件去掉map文件</h2><p>想要做到这一步其实很简单，直接将<code>config/index.js</code>中的<code>productionSourceMap</code>设置为<code>false</code>即可。</p>
<h3 id="那么问题来了，map文件到底是做什么用的呢？"><a href="#那么问题来了，map文件到底是做什么用的呢？" class="headerlink" title="那么问题来了，map文件到底是做什么用的呢？"></a>那么问题来了，map文件到底是做什么用的呢？</h3><p>简单说，Source map就是一个信息文件，里面储存着位置信息。也就是说，转换后的代码的每一个位置，所对应的转换前的位置。</p>
<p>有了它，出错的时候，除错工具将直接显示原始代码，而不是转换后的代码。这无疑给开发者带来了很大方便。</p>
<h3 id="那么为什么会有map文件的到来呢？"><a href="#那么为什么会有map文件的到来呢？" class="headerlink" title="那么为什么会有map文件的到来呢？"></a>那么为什么会有map文件的到来呢？</h3><p>JavaScript脚本正变得越来越复杂。大部分源码（尤其是各种函数库和框架）都要经过转换，才能投入生产环境。常见的源码转换，主要是以下三种情况：</p>
<blockquote>
<p>（1）压缩，减小体积。比如jQuery 1.9的源码，压缩前是252KB，压缩后是32KB。<br>（2）多个文件合并，减少HTTP请求数。<br>（3）其他语言编译成JavaScript。最常见的例子就是CoffeeScript。</p>
</blockquote>
<p>这三种情况，都使得实际运行的代码不同于开发代码，除错（debug）变得困难重重。</p>
<p>通常，JavaScript的解释器会告诉你，第几行第几列代码出错。但是，这对于转换后的代码毫无用处。举例来说，jQuery 1.9压缩后只有3行，每行3万个字符，所有内部变量都改了名字。你看着报错信息，感到毫无头绪，根本不知道它所对应的原始位置。</p>
<p>这就是Source map想要解决的问题。</p>
<h2 id="Vue插件使用"><a href="#Vue插件使用" class="headerlink" title="Vue插件使用"></a>Vue插件使用</h2><h3 id="pagekit-vue-resource"><a href="#pagekit-vue-resource" class="headerlink" title="pagekit/vue-resource"></a><a target="_blank" rel="noopener" href="https://github.com/pagekit/vue-resource">pagekit/vue-resource</a></h3><p>一个Ajax插件，使用过程中遇到了这么一个坑，就是发起<code>POST</code>请求的时候，浏览器默认发起了<code>OPTIONS</code>请求。</p>
<p>那么按照理解来说，一个“非简单请求”在跨域时，浏览器会默认自动帮你发一个<code>OPTIONS</code>请求，到服务器端请求服务器确认该请求的合法性，服务器端必须得有相应的路由处理该请求，并认真返回<code>200</code>响应，然后浏览器才会再次发出正常的、你需要的请求。</p>
<p>那么后端并不会对<code>OPTIONS</code>响应，我们的解决方案就是直接在<code>main.js</code>中加入<code>Vue.http.options.emulateJSON = true</code>。</p>
<p>vue-resource/docs中有这么一段话：</p>
<hr>
<h4 id="Legacy-web-servers"><a href="#Legacy-web-servers" class="headerlink" title="Legacy web servers"></a>Legacy web servers</h4><p>If your web server can’t handle requests encoded as <code>application/json</code>, you can enable the <code>emulateJSON</code> option. This will send the request as <code>application/x-www-form-urlencoded</code> MIME type, as if from an normal HTML form.</p>
<p><code>Vue.http.options.emulateJSON = true;</code></p>
<p>If your web server can’t handle REST/HTTP requests like <code>PUT</code>, <code>PATCH</code> and <code>DELETE</code>, you can enable the <code>emulateHTTP</code> option. This will set the <code>X-HTTP-Method-Override</code> header with the actual HTTP method and use a normal <code>POST</code> request.</p>
<p><code>Vue.http.options.emulateHTTP = true;</code></p>
<hr>
<h3 id="vue-router"><a href="#vue-router" class="headerlink" title="vue-router"></a><a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-router">vue-router</a></h3><p>使用vue-router的想法很简单，因为需求方需要将一个页面放在不同地方，链接是带参数的，那么我想到的是用vue-router利用动态路由匹配来控制跳转链接的地址。</p>
<h2 id="踩坑事件"><a href="#踩坑事件" class="headerlink" title="踩坑事件"></a>踩坑事件</h2><p>先简单的说下我遇到的问题：</p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  data <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      exampleData<span class="token punctuation">:</span> <span class="token string">''</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    exampleMethods<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">// example 1</span>

        <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
          self<span class="token punctuation">.</span>exampleData <span class="token operator">=</span> <span class="token string">'example 1'</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>

      <span class="token comment" spellcheck="true">// example 2</span>

        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>exampleData <span class="token operator">=</span> <span class="token string">'example 2'</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>那么在调用<code>exampleMethods</code>方法后，<code>exampleData</code>的结果是什么呢？</p>
<blockquote>
<p>setTimeout方法是挂在window对象下的。《JavaScript高级程序设计》第二版中，写到：“超时调用的代码都是在全局作用域中执行的，因此函数中this的值在非严格模式下指向window对象，在严格模式下是undefined”。</p>
</blockquote>
<p>所以，在setTimeout中所执行函数中的this，永远指向window。</p>
<p>先卖一个关子，或者你可以尝试下，下次将为大家分享学习过程。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/philosophyatmath/article/details/30246631">Tomcat下部署多个项目</a></li>
<li><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html">JavaScript Source Map 详解</a></li>
</ul>

                </div>
            </div>

            
            
            
    
            
    
            
        </div>
    </div>
    
</div>






