









<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            <div class="post-head-wrapper"
                 style="background-image: url('/2017/11/25/进阶es6二/pic.jpeg')">
                <div class="post-title">
                    进阶ES6（二）
                    <div class="post-meta">
                        <time datetime="2017-11-25T18:22:55.000Z" itemprop="datePublished">
                            2017-11-25 18:22
                        </time>&nbsp;
                        
                        
                        <i class="material-icons" style="">folder</i>
                        
                        <a href='/categories/JavaScript/'>JavaScript</a>
                        
                        
    
                        
                        
                        <i class="material-icons" style="">label</i>
                        
                        <a href='/tags/JavaScript/'>JavaScript</a>, 
                        
                        <a href='/tags/ECMAScript-6/'>ECMAScript 6</a>
                        
                        
                    </div>
                </div>
            </div>
    
            <div class="post-body-wrapper">
                <div class="post-body">
                    <!-- no node -->

<span id="more"></span>

<blockquote>
<p><strong>概要</strong><br>计划本月读完《ECMAScript 6 标准入门》（第3版） =&gt; 完成<br>购入新书《学习JavaScript数据结构与算法》和《深入React技术栈》<br>计划12月读完《学习JavaScript数据结构与算法》<br>计划12月入门React<br><a href="http://zongzi531.com/2017/10/12/%E8%BF%9B%E9%98%B6es6/">前文</a>中提及的PC端管理系统（vue + element-ui）[以下简称：项目B]<br>11月中旬团队开发工行大厂APP第三方页面积分商城项目 [以下简称：项目C]</p>
</blockquote>
<h2 id="Vue-AMap"><a href="#Vue-AMap" class="headerlink" title="Vue-AMap"></a>Vue-AMap</h2><p>接触此组件并紧接着参加饿了么大前端秋季交流会后，对为主流框架提供现有其他服务组件的项目有了新的认识。详细可以查看<a href="http://zongzi531.com/2017/11/05/%E5%8F%82%E5%8A%A02017%E9%A5%BF%E4%BA%86%E4%B9%88%E5%A4%A7%E5%89%8D%E7%AB%AF%E7%A7%8B%E5%AD%A3%E4%BA%A4%E6%B5%81%E4%BC%9A/">《浅谈第三方服务与 Vue 的结合》</a></p>
<p>这里浅谈下使用Vue-AMap的感受。地图业务基本是异步业务，我使用<code>Promise对象</code>和 <code>async函数</code>来完成我的业务需求。</p>
<p>此外Vue-AMap提供<a target="_blank" rel="noopener" href="https://elemefe.github.io/vue-amap/#/zh-cn/introduction/init?id=promise">lazyAMapApiLoaderInstance.load</a>方法返回<code>Promise对象</code>为开发者带来便利。</p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/**
 * **代码实践**
 * locate 和 cloudSearchNearBy 函数传入AMap实例调用高德地图API并返回Promise对象
 */</span>
<span class="token keyword">import</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> lazyAMapApiLoaderInstance <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">from</span> <span class="token string">'vue-amap'</span>

lazyAMapApiLoaderInstance<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> init <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">locate</span><span class="token punctuation">(</span>AMap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// ...定位失败处理</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">cloudSearchNearBy</span><span class="token punctuation">(</span>AMap<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="团队开发"><a href="#团队开发" class="headerlink" title="团队开发"></a>团队开发</h2><p>项目C开发过程中更深刻体会到以下几点重要性：</p>
<ol>
<li>ESLint 代码风格约定</li>
<li>git commit风格约定</li>
<li>代码版本管理</li>
<li>团队分工安排</li>
<li>项目前期需求分析</li>
</ol>
<p>同时祝贺下，项目C已正式上线！</p>
<h2 id="CommonJS-VS-ES6-Module"><a href="#CommonJS-VS-ES6-Module" class="headerlink" title="CommonJS VS ES6 Module"></a>CommonJS VS ES6 Module</h2><p>简单总结下两者差异：</p>
<table>
<thead>
<tr>
<th>模块加载方案</th>
<th align="center">CommonJS</th>
<th align="center">ES6 Module</th>
</tr>
</thead>
<tbody><tr>
<td>加载模式差异</td>
<td align="center">运行时加载</td>
<td align="center">编译时加载</td>
</tr>
<tr>
<td>输出内容差异</td>
<td align="center">输出值的复制</td>
<td align="center">输出值的引用</td>
</tr>
<tr>
<td>加载内容差异</td>
<td align="center">模块整体加载</td>
<td align="center">模块需要加载</td>
</tr>
</tbody></table>
<p>编译时加载带来的好处：</p>
<ul>
<li>不再需要UMD模块格式，将来服务器和浏览器都会支持ES6模块格式。</li>
<li>将来浏览器的新API可以用模块格式提供，不在需要做成全局变量或者navigator对象属性。</li>
<li>不再需要对象作为命名空间（比如Math对象），未来这些功能可以通过模块来提供。</li>
</ul>
<h3 id="项目B"><a href="#项目B" class="headerlink" title="项目B"></a>项目B</h3><p><strong>实践ES6 Module</strong></p>
<ol>
<li><p>表单验证方法集合对象: <a target="_blank" rel="noopener" href="https://github.com/zongzi531/ZGadget/blob/master/element/element-ui-form-validator.js">element-ui 表单验证方法集合对象</a></p>
</li>
<li><p>国内城市选择器: <a target="_blank" rel="noopener" href="https://github.com/zongzi531/ZGadget/blob/master/element/element-ui-Cascader-china-address-v3.js">element-ui 级联选择器 城市数据</a></p>
</li>
</ol>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/**
 * HOW TO USE
 *
 * 1.import ca from './element-ui-Cascader-china-address-v3.js'
 * 2.&lt;el-cascader :options="ca" ... > ... &lt;/el-cascader>
 */</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="微信小程序"><a href="#微信小程序" class="headerlink" title="微信小程序"></a>微信小程序</h3><p>微信小程序目前似乎不支持ES6 Module，而是采用CommonJS模块加载方案。</p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 官方文档示例代码</span>
<span class="token keyword">var</span> common <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'common.js'</span><span class="token punctuation">)</span>
<span class="token function">Page</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  helloMINA<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    common<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">'MINA'</span><span class="token punctuation">)</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
  goodbyeMINA<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    common<span class="token punctuation">.</span><span class="token function">sayGoodbye</span><span class="token punctuation">(</span><span class="token string">'MINA'</span><span class="token punctuation">)</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>详细文档内容请参见<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/app-service/module.html">微信小程序-模块化</a></p>
<h2 id="Key值"><a href="#Key值" class="headerlink" title="Key值"></a>Key值</h2><p>key必须在其兄弟节点中是唯一的，而非全局唯一。万不得已，你可以传递他们在数组中的索引作为key。若元素没有重排，该方法效果不错，但重排会使得其变慢。</p>
<p><strong>权衡</strong></p>
<p>牢记协调算法的实现细节非常重要。React可能会在每次操作时渲染整个应用；而结果仍是相同的。为保证大多数场景效率能更快，我们通常提炼启发式的算法。</p>
<p>在目前实现中，可以表明一个事实，即子树在其兄弟节点中移动，但你无法告知其移动到哪。该算法会重渲整个子树。</p>
<p>由于React依赖于该启发式算法，若其背后的假设没得到满足，则其性能将会受到影响：</p>
<ol>
<li>算法无法尝试匹配不同组件类型的子元素。若你发现两个输出非常相似的组件类型交替出现，你可能希望使其成为相同类型。实践中，我们并非发现这是一个问题。</li>
<li>Keys应该是稳定的，可预测的，且唯一的。不稳定的key（类似由Math.random()生成的）将使得大量组件实例和DOM节点进行不必要的重建，使得性能下降并丢失子组件的状态。</li>
</ol>
<p>相关资料：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/api/#key">Vue特殊特性Key</a></li>
<li><a target="_blank" rel="noopener" href="https://doc.react-china.org/docs/lists-and-keys.html#keys">React Key</a></li>
<li><a target="_blank" rel="noopener" href="https://doc.react-china.org/docs/reconciliation.html#%E9%80%92%E5%BD%92%E5%AD%90%E8%8A%82%E7%82%B9">深度解析Key的重要性</a></li>
</ul>
<h2 id="Vuex"><a href="#Vuex" class="headerlink" title="Vuex"></a>Vuex</h2><p>论优雅的使用Vuex重要性，请认真阅读Vuex官方文档。</p>
<p>每一个 Vuex 应用的核心就是 store（仓库）。“store”基本上就是一个容器，它包含着你的应用中大部分的状态 (state)。Vuex 和单纯的全局对象有以下两点不同：</p>
<ol>
<li><p>Vuex 的状态存储是响应式的。当 Vue 组件从 store 中读取状态的时候，若 store 中的状态发生变化，那么相应的组件也会相应地得到高效更新。</p>
</li>
<li><p>你<strong>不能直接改变</strong> store 中的状态。改变 store 中的状态的唯一途径就是<strong>显式地提交 (commit) mutation</strong>。这样使得我们可以方便地跟踪每一个状态的变化，从而让我们能够实现一些工具帮助我们更好地了解我们的应用。</p>
</li>
</ol>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 如果在模块化构建系统中，请确保在开头调用了 Vue.use(Vuex)</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  state<span class="token punctuation">:</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    count<span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
  mutations<span class="token punctuation">:</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    increment <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      state<span class="token punctuation">.</span>count<span class="token operator">++</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 不优雅</span>
store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token operator">++</span>

<span class="token comment" spellcheck="true">// 优雅</span>
store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>那么优雅的使用Vuex就是：</p>
<ul>
<li>同步操作: store.commit方法提交mutation</li>
<li>异步操作: store.dispatch方法触发action</li>
</ul>
<h3 id="element-ui-清空所有表单项的验证信息"><a href="#element-ui-清空所有表单项的验证信息" class="headerlink" title="element-ui 清空所有表单项的验证信息"></a>element-ui 清空所有表单项的验证信息</h3><p>在优雅的使用Vuex时，考虑到表单操作都要采用显式地提交 (commit) mutation来实现，通过element-ui提供的resetFields方法，会在Vuex严格模式下报错。</p>
<p>查看源码会发现，可以单独提出一个清空所有表单项的验证信息的方法，实践如下：</p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/**
* clearValidate 用于element-ui V1.4.10 clearValidate 方法，用于清空所有表单项的验证信息
* @param  &amp;#123;Object&amp;#125; formName 传入this.$refs[formName]
* @return
*/</span>
<span class="token keyword">function</span> clearValidate <span class="token punctuation">(</span>formName<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>formName<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> fields <span class="token operator">=</span> formName<span class="token punctuation">.</span>fields
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> item <span class="token keyword">of</span> fields<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      item<span class="token punctuation">.</span>validateState <span class="token operator">=</span> <span class="token string">''</span>
      item<span class="token punctuation">.</span>validateMessage <span class="token operator">=</span> <span class="token string">''</span>
      item<span class="token punctuation">.</span>validateDisabled <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>element-ui 2.0.0 已经新增此方法 <a target="_blank" rel="noopener" href="https://github.com/ElemeFE/element/pull/7623">#7623</a></p>
<hr>
<p>我意识到ES6了解完后需要更深入的理解JavaScript，对函数式编程的向往促使我去看React。</p>
<p>我认为现在还不是时机去学习node，我准备在更了解ES6，更了解JavaScript，那时，才是学习node的好时机。</p>

                </div>
            </div>

            
            
            
    
            
    
            
        </div>
    </div>
    
</div>






