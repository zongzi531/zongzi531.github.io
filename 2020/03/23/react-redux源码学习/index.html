

<!DOCTYPE html>
<html lang="zh-CN" xmlns:v-bind="http://www.w3.org/1999/xhtml">

<head>
    <title>React Redux 源码学习 - Zong</title>
<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="author" content="Zong">
<meta name="description" content="




继 Redux 源码学习之后，我们来看一看 React Redux 是如何将 Redux 和 React...">
<meta name="keywords" content="Blog JavaScript TypeScript Front-end CSS">

    <meta charset="utf-8">
    <meta name="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta content="telephone=no" name="format-detection">
    <meta name="renderer" content="webkit">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
<link rel="stylesheet" href="/css/journal.css?10006108">

<link rel="icon" href="/images/favicon.ico">

<script src="/js/loadCSS.js"></script>
<script>
    loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Material+Icons");
    (function(d) {
        var config = {
        kitId: 'ojl5tfq',
        scriptTimeout: 3000,
        async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
    })(document);
</script>
<noscript>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Lora|Montserrat|Anonymous+Pro:400|Material+Icons"/>
</noscript>
<meta name="generator" content="Hexo 7.1.1"><link rel="alternate" href="/atom.xml" title="Zong" type="application/atom+xml">
</head>
<body>
<div id="top"></div>
<div id="app">
<div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            <a class="a-block drawer-menu-item false" href="https://zongzi531.com">
                首页
            </a>
            

            
            
                
                    <a class="a-block drawer-menu-item false" href="/bangumi/index.html">
                        番組
                    </a>
                
            
                
                    <a class="a-block drawer-menu-item false" href="/commuting/index.html">
                        通勤那点事
                    </a>
                
            
                
            
                
            
                
            
                
            
                
                    <a class="a-block drawer-menu-item false" href="/nihongonokona/index.html">
                        日本語のコーナー
                    </a>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
                    <a class="a-block drawer-menu-item false" href="/syoukai/index.html">
                        紹介
                    </a>
                
            
                
            

            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="/">
            Zong
        </a>
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="/">
        <div class="single-column-header-title">Zong</div>
        <div class="single-column-header-subtitle"></div>
    </a>
</div>
<div ref="sideContainer" class="side-container">
    <a class="a-block nav-head false" href="/">
        <div class="nav-title">
            Zong
        </div>
        <div class="nav-subtitle">
            人之所以能<br>，是相信能
        </div>
    </a>

    <div class="nav-link-list">
        

        
        
            
                <a class="a-block nav-link-item false" href="/bangumi/index.html">
                    番組
                </a>
            
        
            
                <a class="a-block nav-link-item false" href="/commuting/index.html">
                    通勤那点事
                </a>
            
        
            
        
            
        
            
        
            
        
            
                <a class="a-block nav-link-item false" href="/nihongonokona/index.html">
                    日本語のコーナー
                </a>
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
                <a class="a-block nav-link-item false" href="/syoukai/index.html">
                    紹介
                </a>
            
        
            
        

        
    </div>

    <div class="nav-footer">
        <div style="margin-bottom: 8px;">
            <a title="GitHub" target="_blank" rel="noopener" href="https://github.com/zongzi531" style="margin: 0px 2px;"><svg height="16" width="16" viewBox="0 0 16 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg></a>
            <a title="知乎" target="_blank" rel="noopener" href="https://www.zhihu.com/people/zongzi531/posts" style="margin: 0px 2px;"><img height="16" src="https://static.zhihu.com/static/favicon.ico"></a>
            <a title="掘金" target="_blank" rel="noopener" href="https://juejin.im/user/58747cf2ac502e00646e3b8b/posts" style="margin: 0px 2px;"><img height="16" src="https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web//static/favicons/favicon-32x32.png"></a>
            <a title="力扣" target="_blank" rel="noopener" href="https://leetcode-cn.com/u/zongzi0531/" style="margin: 0px 2px;"><img height="16" src="https://static.leetcode-cn.com/cn-assets/icons/favicon-32x32.png"></a>
        </div>
        &copy; 2017 - 2024 <a href="https://zongzi531.com">Zong</a>
    </div>
</div>
<div ref="extraContainer" class="extra-container">
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>

        
    </div>
</div>



<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            <div class="post-head-wrapper"
                 style="background-image: url('/2020/03/23/react-redux源码学习/pic.png')">
                <div class="post-title">
                    React Redux 源码学习
                    <div class="post-meta">
                        <time datetime="2020-03-23T17:06:07.000Z" itemprop="datePublished">
                            2020-03-23 17:06
                        </time>&nbsp;
                        
                        
                        <i class="material-icons" style="">folder</i>
                        
                        <a href='/categories/React/'>React</a>
                        
                        
    
                        
                        
                        <i class="material-icons" style="">label</i>
                        
                        <a href='/tags/React/'>React</a>, 
                        
                        <a href='/tags/Redux/'>Redux</a>
                        
                        
                    </div>
                </div>
            </div>
    
            <div class="post-body-wrapper">
                <div class="post-body">
                    <!-- no node -->

<span id="more"></span>

<blockquote>
<p>继 Redux 源码学习之后，我们来看一看 React Redux 是如何将 Redux 和 React 组合起来的。<br>我正在阅读的则是 <code>7.2.0</code> 版本代码。</p>
</blockquote>
<p>我们依然围绕着 <code>src</code> 进行学习。可以看到源码中已经在使用 Hook 代码。如果你暂时还对 Hook 不是很了解的话，建议先前往 React 官网学习 Hook 内容。</p>
<p>从目录来看 <code>utils</code> 依然是简单的工具， <code>hooks</code> 下则是一些对外提供的 Hook ， <code>connect</code> 下则是我们每次都要使用的<strong>高阶组件</strong>函数， <code>components</code> 则也是我们每次都要使用的 <code>Provider</code> 组件。其中， <code>connect/connect.js</code> 其实是对 <code>components/connectAdvanced.js</code> 的封装。</p>
<p>示例代码中我会移除并省略掉一些逻辑代码以及一些我认为不那么重要的代码，即只展现我想要说明的内容。</p>
<p>有必要提到的是 <code>utils/batch.js</code> 和 <code>index.js</code> 中的部分源码，其中涉及到 React 协调中的批量更新，并且在 <code>utils/Subscription.js</code> 有使用到。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// utils/batch.js</span>
<span class="token keyword">let</span> <span class="token function-variable function">batch</span> <span class="token operator">=</span> <span class="token parameter">callback</span> <span class="token operator">=></span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">setBatch</span> <span class="token operator">=</span> <span class="token parameter">newBatch</span> <span class="token operator">=></span> <span class="token punctuation">(</span>batch <span class="token operator">=</span> newBatch<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getBatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> batch
<span class="token comment">// index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> setBatch <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./utils/batch'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> unstable_batchedUpdates <span class="token keyword">as</span> batch <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-dom'</span>

<span class="token function">setBatch</span><span class="token punctuation">(</span>batch<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Subscription"><a href="#Subscription" class="headerlink" title="Subscription"></a>Subscription</h2><p>从上面我们可以看出 React Redux 这里使用的更新模式并不是“普通”的执行函数，而是依赖于 React DOM 的批量更新，作为了解学习即可，可以增进一些自己的思路。现在，让我们来看到 <code>utils/Subscription.js</code> 的源码：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">createListenerCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 依赖于 React DOM 的批量更新</span>
  <span class="token keyword">const</span> batch <span class="token operator">=</span> <span class="token function">getBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 监听器链表头和尾</span>
  <span class="token keyword">let</span> first <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">let</span> last <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token comment">// 典型的闭包结构</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 清空链表</span>
    <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      first <span class="token operator">=</span> <span class="token keyword">null</span>
      last <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">// 通知函数</span>
    <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 调用依赖于 React DOM 的批量更新</span>
      <span class="token function">batch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> listener <span class="token operator">=</span> first
        <span class="token keyword">while</span> <span class="token punctuation">(</span>listener<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          listener<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          listener <span class="token operator">=</span> listener<span class="token punctuation">.</span>next
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">// 获取监听器列表</span>
    <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">let</span> listeners <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token keyword">let</span> listener <span class="token operator">=</span> first
      <span class="token keyword">while</span> <span class="token punctuation">(</span>listener<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        listeners<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span>
        listener <span class="token operator">=</span> listener<span class="token punctuation">.</span>next
      <span class="token punctuation">&#125;</span>
      <span class="token keyword">return</span> listeners
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">// 订阅回调函数，添加至监听器链表</span>
    <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">let</span> isSubscribed <span class="token operator">=</span> <span class="token boolean">true</span>

      <span class="token keyword">let</span> listener <span class="token operator">=</span> <span class="token punctuation">(</span>last <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        callback<span class="token punctuation">,</span>
        <span class="token literal-property property">next</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">prev</span><span class="token operator">:</span> last
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>listener<span class="token punctuation">.</span>prev<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        listener<span class="token punctuation">.</span>prev<span class="token punctuation">.</span>next <span class="token operator">=</span> listener
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        first <span class="token operator">=</span> listener
      <span class="token punctuation">&#125;</span>
      <span class="token comment">// 返回取消订阅函数（典型的闭包结构）</span>
      <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isSubscribed <span class="token operator">||</span> first <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
        isSubscribed <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token comment">// 将加入的监听器移除</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>listener<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          listener<span class="token punctuation">.</span>next<span class="token punctuation">.</span>prev <span class="token operator">=</span> listener<span class="token punctuation">.</span>prev
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
          last <span class="token operator">=</span> listener<span class="token punctuation">.</span>prev
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>listener<span class="token punctuation">.</span>prev<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          listener<span class="token punctuation">.</span>prev<span class="token punctuation">.</span>next <span class="token operator">=</span> listener<span class="token punctuation">.</span>next
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
          first <span class="token operator">=</span> listener<span class="token punctuation">.</span>next
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Subscription</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">store<span class="token punctuation">,</span> parentSub</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 初始化</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>store <span class="token operator">=</span> store
    <span class="token keyword">this</span><span class="token punctuation">.</span>parentSub <span class="token operator">=</span> parentSub
    <span class="token keyword">this</span><span class="token punctuation">.</span>unsubscribe <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>listeners <span class="token operator">=</span> nullListeners
    <span class="token comment">// 绑定执行上下文</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handleChangeWrapper <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleChangeWrapper</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// 添加监听器回调</span>
  <span class="token function">addNestedSub</span><span class="token punctuation">(</span><span class="token parameter">listener</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">trySubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// 监听器通知</span>
  <span class="token function">notifyNestedSubs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// 处理指定 API onStateChange</span>
  <span class="token function">handleChangeWrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onStateChange<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onStateChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// 是否尝试过订阅</span>
  <span class="token function">isSubscribed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>unsubscribe<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// 订阅</span>
  <span class="token function">trySubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>unsubscribe<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>unsubscribe <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parentSub
        <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parentSub<span class="token punctuation">.</span><span class="token function">addNestedSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChangeWrapper<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChangeWrapper<span class="token punctuation">)</span>
      <span class="token comment">// 创建监听器集合</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>listeners <span class="token operator">=</span> <span class="token function">createListenerCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// 退订清除缓存</span>
  <span class="token function">tryUnsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>unsubscribe<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>unsubscribe <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>listeners <span class="token operator">=</span> nullListeners
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h2><p>上面是一个订阅器的简单实现，也是 <code>Provider</code> 组件触发更新的原理，那么话不多说，我们来看到 <code>components</code> 目录下 <code>Provider.js</code> 的相关源码：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> ReactReduxContext <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">Provider</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> store<span class="token punctuation">,</span> context<span class="token punctuation">,</span> children <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> contextValue <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 实例化 Subscription</span>
    <span class="token keyword">const</span> subscription <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subscription</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>
    <span class="token comment">// API onStateChange 设置</span>
    subscription<span class="token punctuation">.</span>onStateChange <span class="token operator">=</span> subscription<span class="token punctuation">.</span>notifyNestedSubs
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
      store<span class="token punctuation">,</span>
      subscription
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>store<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token comment">// Redux state 获取 API 调用 </span>
  <span class="token keyword">const</span> previousState <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>store<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> subscription <span class="token punctuation">&#125;</span> <span class="token operator">=</span> contextValue
    <span class="token comment">// 尝试订阅并创建监听器集合</span>
    subscription<span class="token punctuation">.</span><span class="token function">trySubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>previousState <span class="token operator">!==</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 若新旧 state 不一样则发起通知，执行监听器列表</span>
      subscription<span class="token punctuation">.</span><span class="token function">notifyNestedSubs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 清除副作用</span>
      subscription<span class="token punctuation">.</span><span class="token function">tryUnsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      subscription<span class="token punctuation">.</span>onStateChange <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>contextValue<span class="token punctuation">,</span> previousState<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token comment">// 用户自定义 Context 优先</span>
  <span class="token keyword">const</span> Context <span class="token operator">=</span> context <span class="token operator">||</span> ReactReduxContext
  <span class="token comment">// contextValue 包含整个 Redux 实例和订阅器</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Context<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span>contextValue<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">&#123;</span>children<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Context<span class="token punctuation">.</span>Provider<span class="token operator">></span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="connect"><a href="#connect" class="headerlink" title="connect"></a>connect</h2><p>看到这里其实已经明白 <code>Provider</code> 组件的整个逻辑，即依据 <code>store</code> 或 <code>previousState</code> 的变化触发订阅退订的生命周期以及通知更新操作。那么再和 <code>connect</code> 高阶组件函数配合实现 React Redux 的功能。显然，到了这里我想大家都应该能猜到， <code>Provider</code> 组件用于注入 Redux 并控制逻辑，<code>connect</code> 高阶组件函数来处理用户想要的 <code>store</code> 以 <code>props</code> 的形式传入。我们先来看到 <code>connectAdvanced.js</code> 的源码吧（下面内容有些多，我陪你一点点看下去）：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">connectAdvanced</span><span class="token punctuation">(</span>
  <span class="token comment">/*
    选择器工厂函数（默认官方提供）作用是生成类似这样的代码内容：
    export default connectAdvanced((dispatch, options) => (state, props) => (&#123;
      thing: state.things[props.thingId],
      saveThing: fields => dispatch(actionCreators.saveThing(props.thingId, fields)),
    &#125;))(YourComponent)
  */</span>
  selectorFactory<span class="token punctuation">,</span>
  <span class="token comment">// 配置参数，官方已在 connect 进行封装（当然用户可以自己魔改），所以我们在使用的时候用的是 connect</span>
  <span class="token punctuation">&#123;</span>
    <span class="token comment">// the func used to compute this HOC's displayName from the wrapped component's displayName.</span>
    <span class="token comment">// probably overridden by wrapper functions such as connect()</span>
    <span class="token function-variable function">getDisplayName</span> <span class="token operator">=</span> <span class="token parameter">name</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ConnectAdvanced(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token comment">// shown in error messages</span>
    <span class="token comment">// probably overridden by wrapper functions such as connect()</span>
    methodName <span class="token operator">=</span> <span class="token string">'connectAdvanced'</span><span class="token punctuation">,</span>
    <span class="token comment">// REMOVED: if defined, the name of the property passed to the wrapped element indicating the number of</span>
    <span class="token comment">// calls to render. useful for watching in react devtools for unnecessary re-renders.</span>
    renderCountProp <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    <span class="token comment">// determines whether this HOC subscribes to store changes</span>
    shouldHandleStateChanges <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// REMOVED: the key of props/context to get the store</span>
    storeKey <span class="token operator">=</span> <span class="token string">'store'</span><span class="token punctuation">,</span>
    <span class="token comment">// REMOVED: expose the wrapped component via refs</span>
    withRef <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token comment">// use React's forwardRef to expose a ref of the wrapped component</span>
    forwardRef <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token comment">// the context consumer to use</span>
    context <span class="token operator">=</span> ReactReduxContext<span class="token punctuation">,</span>
    <span class="token comment">// additional options are passed through to the selectorFactory</span>
    <span class="token operator">...</span>connectOptions
  <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> Context <span class="token operator">=</span> context
  <span class="token comment">// 典型的 HOC 写法</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">wrapWithConnect</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> wrappedComponentName <span class="token operator">=</span>
      WrappedComponent<span class="token punctuation">.</span>displayName <span class="token operator">||</span> WrappedComponent<span class="token punctuation">.</span>name <span class="token operator">||</span> <span class="token string">'Component'</span>

    <span class="token keyword">const</span> displayName <span class="token operator">=</span> <span class="token function">getDisplayName</span><span class="token punctuation">(</span>wrappedComponentName<span class="token punctuation">)</span>
    <span class="token comment">// 选择器工厂函数所需参数</span>
    <span class="token keyword">const</span> selectorFactoryOptions <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
      <span class="token operator">...</span>connectOptions<span class="token punctuation">,</span>
      getDisplayName<span class="token punctuation">,</span>
      methodName<span class="token punctuation">,</span>
      renderCountProp<span class="token punctuation">,</span>
      shouldHandleStateChanges<span class="token punctuation">,</span>
      storeKey<span class="token punctuation">,</span>
      displayName<span class="token punctuation">,</span>
      wrappedComponentName<span class="token punctuation">,</span>
      WrappedComponent
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// “ prue ”即一种模式，默认为开启。影响 Memo 相关内容，可以视做是一种性能优化</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> pure <span class="token punctuation">&#125;</span> <span class="token operator">=</span> connectOptions
    <span class="token keyword">const</span> usePureOnlyMemo <span class="token operator">=</span> pure <span class="token operator">?</span> <span class="token function-variable function">useMemo</span> <span class="token operator">:</span> <span class="token parameter">callback</span> <span class="token operator">=></span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 函数组件 ConnectFunction</span>
    <span class="token keyword">function</span> <span class="token function">ConnectFunction</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// props 分类</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>propsContext<span class="token punctuation">,</span> forwardedRef<span class="token punctuation">,</span> wrapperProps<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> forwardedRef<span class="token punctuation">,</span> <span class="token operator">...</span>wrapperProps <span class="token punctuation">&#125;</span> <span class="token operator">=</span> props
        <span class="token keyword">return</span> <span class="token punctuation">[</span>props<span class="token punctuation">.</span>context<span class="token punctuation">,</span> forwardedRef<span class="token punctuation">,</span> wrapperProps<span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>props<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token comment">// 选择默认 Context 或用户自己传入的 Context</span>
      <span class="token keyword">const</span> ContextToUse <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> propsContext <span class="token operator">&amp;&amp;</span>
          propsContext<span class="token punctuation">.</span>Consumer <span class="token operator">&amp;&amp;</span>
          <span class="token function">isContextConsumer</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>propsContext<span class="token punctuation">.</span>Consumer <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span>
          <span class="token operator">?</span> propsContext
          <span class="token operator">:</span> Context
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>propsContext<span class="token punctuation">,</span> Context<span class="token punctuation">]</span><span class="token punctuation">)</span>

      <span class="token keyword">const</span> contextValue <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ContextToUse<span class="token punctuation">)</span>
      <span class="token comment">// 典型的鸭子模型辨认法</span>
      <span class="token keyword">const</span> didStoreComeFromProps <span class="token operator">=</span>
        <span class="token function">Boolean</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>store<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token function">Boolean</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>store<span class="token punctuation">.</span>getState<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token function">Boolean</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>store<span class="token punctuation">.</span>dispatch<span class="token punctuation">)</span>
      <span class="token keyword">const</span> didStoreComeFromContext <span class="token operator">=</span>
        <span class="token function">Boolean</span><span class="token punctuation">(</span>contextValue<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">Boolean</span><span class="token punctuation">(</span>contextValue<span class="token punctuation">.</span>store<span class="token punctuation">)</span>
      <span class="token keyword">const</span> store <span class="token operator">=</span> didStoreComeFromProps <span class="token operator">?</span> props<span class="token punctuation">.</span>store <span class="token operator">:</span> contextValue<span class="token punctuation">.</span>store
      <span class="token comment">// props 选择器，对应源码为 finalPropsSelectorFactory 函数，可以理解为一个包装层</span>
      <span class="token keyword">const</span> childPropsSelector <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">selectorFactory</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>dispatch<span class="token punctuation">,</span> selectorFactoryOptions<span class="token punctuation">)</span><span class="token comment">/* createChildSelector(store) */</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>store<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token comment">// 订阅器及通知函数创建</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>subscription<span class="token punctuation">,</span> notifyNestedSubs<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>shouldHandleStateChanges<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">]</span><span class="token comment">/* NO_SUBSCRIPTION_ARRAY */</span>
        <span class="token comment">// 实例化 Subscription</span>
        <span class="token keyword">const</span> subscription <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subscription</span><span class="token punctuation">(</span>
          store<span class="token punctuation">,</span>
          didStoreComeFromProps <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> contextValue<span class="token punctuation">.</span>subscription
        <span class="token punctuation">)</span>
        <span class="token comment">// 绑定 notifyNestedSubs 的执行上下文环境</span>
        <span class="token keyword">const</span> notifyNestedSubs <span class="token operator">=</span> subscription<span class="token punctuation">.</span><span class="token function">notifyNestedSubs</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>
          subscription
        <span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>subscription<span class="token punctuation">,</span> notifyNestedSubs<span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>store<span class="token punctuation">,</span> didStoreComeFromProps<span class="token punctuation">,</span> contextValue<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token comment">// Determine what &#123;store, subscription&#125; value should be put into nested context, if necessary,</span>
      <span class="token comment">// and memoize that value to avoid unnecessary context updates.</span>
      <span class="token keyword">const</span> overriddenContextValue <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>didStoreComeFromProps<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> contextValue
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
          <span class="token operator">...</span>contextValue<span class="token punctuation">,</span>
          subscription
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>didStoreComeFromProps<span class="token punctuation">,</span> contextValue<span class="token punctuation">,</span> subscription<span class="token punctuation">]</span><span class="token punctuation">)</span>

      <span class="token keyword">const</span> lastChildProps <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> lastWrapperProps <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>wrapperProps<span class="token punctuation">)</span>
      <span class="token keyword">const</span> childPropsFromStoreUpdate <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> renderIsScheduled <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
      <span class="token comment">// 实际的 props</span>
      <span class="token keyword">const</span> actualChildProps <span class="token operator">=</span> <span class="token function">usePureOnlyMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          childPropsFromStoreUpdate<span class="token punctuation">.</span>current <span class="token operator">&amp;&amp;</span>
          wrapperProps <span class="token operator">===</span> lastWrapperProps<span class="token punctuation">.</span>current
        <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> childPropsFromStoreUpdate<span class="token punctuation">.</span>current
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// props 选择器，同包装层</span>
        <span class="token keyword">return</span> <span class="token function">childPropsSelector</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> wrapperProps<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>store<span class="token punctuation">,</span> wrapperProps<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token comment">// Hook useEffect 或 useLayoutEffect</span>
      <span class="token function">useIsomorphicLayoutEffect</span><span class="token punctuation">(</span><span class="token comment">/* captureWrapperProps */</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 用于更新最新的 props 相关</span>
        lastWrapperProps<span class="token punctuation">.</span>current <span class="token operator">=</span> wrapperProps
        lastChildProps<span class="token punctuation">.</span>current <span class="token operator">=</span> actualChildProps
        renderIsScheduled<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token comment">// 根据条件通知</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>childPropsFromStoreUpdate<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          childPropsFromStoreUpdate<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">null</span>
          <span class="token function">notifyNestedSubs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
      <span class="token comment">// Our re-subscribe logic only runs when the store/subscription setup changes</span>
      <span class="token function">useIsomorphicLayoutEffect</span><span class="token punctuation">(</span><span class="token comment">/* subscribeUpdates */</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>shouldHandleStateChanges<span class="token punctuation">)</span> <span class="token keyword">return</span>

        <span class="token keyword">let</span> didUnsubscribe <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token comment">// 检查更新函数</span>
        <span class="token keyword">const</span> <span class="token function-variable function">checkForUpdates</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>didUnsubscribe<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token punctuation">&#125;</span>
          <span class="token keyword">const</span> latestStoreState <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token comment">// props 选择器（非包装层，可以理解为 impureFinalPropsSelector 函数，因为省略源码的关系，重名）</span>
          <span class="token keyword">let</span> newChildProps <span class="token operator">=</span> <span class="token function">childPropsSelector</span><span class="token punctuation">(</span>
            latestStoreState<span class="token punctuation">,</span>
            lastWrapperProps<span class="token punctuation">.</span>current
          <span class="token punctuation">)</span>
          <span class="token comment">// 如果 props 未变化，则此处无事可做 - 级联订阅更新</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>newChildProps <span class="token operator">===</span> lastChildProps<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>renderIsScheduled<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
              <span class="token comment">// 通知</span>
              <span class="token function">notifyNestedSubs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// props 变化，触发通知</span>
            lastChildProps<span class="token punctuation">.</span>current <span class="token operator">=</span> newChildProps
            childPropsFromStoreUpdate<span class="token punctuation">.</span>current <span class="token operator">=</span> newChildProps
            renderIsScheduled<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 订阅 checkForUpdates</span>
        subscription<span class="token punctuation">.</span>onStateChange <span class="token operator">=</span> checkForUpdates
        subscription<span class="token punctuation">.</span><span class="token function">trySubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 首次检查</span>
        <span class="token function">checkForUpdates</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 取消订阅函数用于返回</span>
        <span class="token keyword">const</span> <span class="token function-variable function">unsubscribeWrapper</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          didUnsubscribe <span class="token operator">=</span> <span class="token boolean">true</span>
          subscription<span class="token punctuation">.</span><span class="token function">tryUnsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          subscription<span class="token punctuation">.</span>onStateChange <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> unsubscribeWrapper
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>store<span class="token punctuation">,</span> subscription<span class="token punctuation">,</span> childPropsSelector<span class="token comment">/* 包装层 */</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

      <span class="token keyword">const</span> renderedWrappedComponent <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">&#123;</span><span class="token operator">...</span>actualChildProps<span class="token punctuation">&#125;</span> ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>forwardedRef<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>forwardedRef<span class="token punctuation">,</span> WrappedComponent<span class="token punctuation">,</span> actualChildProps<span class="token punctuation">]</span>
      <span class="token punctuation">)</span>

      <span class="token keyword">const</span> renderedChild <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 性能优化标示，若为 false 则不重新渲染</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldHandleStateChanges<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>ContextToUse<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span>overriddenContextValue<span class="token punctuation">&#125;</span><span class="token operator">></span>
              <span class="token punctuation">&#123;</span>renderedWrappedComponent<span class="token punctuation">&#125;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ContextToUse<span class="token punctuation">.</span>Provider<span class="token operator">></span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">return</span> renderedWrappedComponent
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>ContextToUse<span class="token punctuation">,</span> renderedWrappedComponent<span class="token punctuation">,</span> overriddenContextValue<span class="token punctuation">]</span><span class="token punctuation">)</span>

      <span class="token keyword">return</span> renderedChild
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">const</span> Connect <span class="token operator">=</span> pure <span class="token operator">?</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>ConnectFunction<span class="token punctuation">)</span> <span class="token operator">:</span> ConnectFunction
    Connect<span class="token punctuation">.</span>WrappedComponent <span class="token operator">=</span> WrappedComponent
    Connect<span class="token punctuation">.</span>displayName <span class="token operator">=</span> displayName
    <span class="token comment">// 此处省略含有 React.forwardRef 相关的特殊场景下的代码内容，若感兴趣请移步至 Github 仓库查看</span>
    <span class="token comment">// 关于 hoistStatics 请查看： Copies non-react specific statics from a child component to a parent component.</span>
    <span class="token comment">// Similar to Object.assign, but with React static keywords blacklisted from being overridden.</span>
    <span class="token keyword">return</span> <span class="token function">hoistStatics</span><span class="token punctuation">(</span>Connect<span class="token punctuation">,</span> WrappedComponent<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>到这里， <code>connectAdvanced</code> 高阶组件函数的内容已阅读完，因为篇幅关系，我移除了部分代码，可能会导致理解不足，就像我在前面说的，这个高阶组件的功能就是如此，若大家想深入建议前往 Github 仓库查看，大部分内容是一些细节的处理。</p>
<p>是不是觉得内容有些爆炸，有些多。确实有些，不如，先去喝杯水，上个洗手间，放松一下，我们再继续。</p>
<p>我们在看到后面的源码（ <code>connect.js</code> ）之前需要先看一些内容，还记得 <code>connect</code> 函数执行的时候传入的参数类似于 <code>mapStateToProps</code> 或者 <code>mapDispatchToProps</code> 的过滤参数，源码中我会移除这部份内容，所以我在开头先来举例说明。</p>
<p>源码中以 <code>match</code> 函数来对参数进行识别，以条件选项最多的 <code>mapDispatchToProps</code> 为例子。</p>
<p>即对入参进行如下顺序校验，优先满足即返回：</p>
<ol>
<li><code>whenMapDispatchToPropsIsFunction</code> 传入识别为函数</li>
<li><code>whenMapDispatchToPropsIsMissing</code> 未传入</li>
<li><code>whenMapDispatchToPropsIsObject</code> 传入识别为对象</li>
</ol>
<p>在了解过这个后，我们来回到源码：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createConnect</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  connectHOC <span class="token operator">=</span> connectAdvanced<span class="token comment">/* HOC */</span><span class="token punctuation">,</span>
  mapStateToPropsFactories <span class="token operator">=</span> defaultMapStateToPropsFactories<span class="token punctuation">,</span>
  mapDispatchToPropsFactories <span class="token operator">=</span> defaultMapDispatchToPropsFactories<span class="token punctuation">,</span>
  mergePropsFactories <span class="token operator">=</span> defaultMergePropsFactories<span class="token punctuation">,</span>
  selectorFactory <span class="token operator">=</span> defaultSelectorFactory
<span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 看到这里是不是少许熟悉了一些</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">connect</span><span class="token punctuation">(</span>
    <span class="token parameter">mapStateToProps<span class="token punctuation">,</span>
    mapDispatchToProps<span class="token punctuation">,</span>
    mergeProps<span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      pure <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      areStatesEqual <span class="token operator">=</span> strictEqual<span class="token punctuation">,</span>
      areOwnPropsEqual <span class="token operator">=</span> shallowEqual<span class="token punctuation">,</span>
      areStatePropsEqual <span class="token operator">=</span> shallowEqual<span class="token punctuation">,</span>
      areMergedPropsEqual <span class="token operator">=</span> shallowEqual<span class="token punctuation">,</span>
      <span class="token operator">...</span>extraOptions
    <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></span>
  <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 分别进行入参识别</span>
    <span class="token keyword">const</span> initMapStateToProps <span class="token operator">=</span> <span class="token function">match</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> mapStateToPropsFactories<span class="token punctuation">,</span> <span class="token string">'mapStateToProps'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> initMapDispatchToProps <span class="token operator">=</span> <span class="token function">match</span><span class="token punctuation">(</span>mapDispatchToProps<span class="token punctuation">,</span> mapDispatchToPropsFactories<span class="token punctuation">,</span> <span class="token string">'mapDispatchToProps'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> initMergeProps <span class="token operator">=</span> <span class="token function">match</span><span class="token punctuation">(</span>mergeProps<span class="token punctuation">,</span> mergePropsFactories<span class="token punctuation">,</span> <span class="token string">'mergeProps'</span><span class="token punctuation">)</span>
    <span class="token comment">// 对 connectAdvanced 的封装</span>
    <span class="token keyword">return</span> <span class="token function">connectHOC</span><span class="token punctuation">(</span>selectorFactory<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// used in error messages</span>
      <span class="token literal-property property">methodName</span><span class="token operator">:</span> <span class="token string">'connect'</span><span class="token punctuation">,</span>
      <span class="token comment">// used to compute Connect's displayName from the wrapped component's displayName.</span>
      <span class="token function-variable function">getDisplayName</span><span class="token operator">:</span> <span class="token parameter">name</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Connect(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token comment">// if mapStateToProps is falsy, the Connect component doesn't subscribe to store state changes</span>
      <span class="token literal-property property">shouldHandleStateChanges</span><span class="token operator">:</span> <span class="token function">Boolean</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// passed through to selectorFactory</span>
      initMapStateToProps<span class="token punctuation">,</span>
      initMapDispatchToProps<span class="token punctuation">,</span>
      initMergeProps<span class="token punctuation">,</span>
      pure<span class="token punctuation">,</span>
      areStatesEqual<span class="token punctuation">,</span>
      areOwnPropsEqual<span class="token punctuation">,</span>
      areStatePropsEqual<span class="token punctuation">,</span>
      areMergedPropsEqual<span class="token punctuation">,</span>
      <span class="token comment">// any extra options args can override defaults of connect or connectAdvanced</span>
      <span class="token operator">...</span>extraOptions
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token comment">/*#__PURE__*/</span> <span class="token function">createConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>那么到此，我们已经看完 <code>connect</code> 函数的内容。</p>
<p>回到前面的内容，整个高阶组件函数是为了实现：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connectAdvanced</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">thing</span><span class="token operator">:</span> state<span class="token punctuation">.</span>things<span class="token punctuation">[</span>props<span class="token punctuation">.</span>thingId<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function-variable function">saveThing</span><span class="token operator">:</span> <span class="token parameter">fields</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span>actionCreators<span class="token punctuation">.</span><span class="token function">saveThing</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>thingId<span class="token punctuation">,</span> fields<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>YourComponent<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>类似于这样的代码，所以到目前为止是不是漏了点什么？是的，被你发现了。是 <code>selectorFactory</code> ：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">impureFinalPropsSelectorFactory</span><span class="token punctuation">(</span>
  <span class="token parameter">mapStateToProps<span class="token punctuation">,</span>
  mapDispatchToProps<span class="token punctuation">,</span>
  mergeProps<span class="token punctuation">,</span>
  dispatch</span>
<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">impureFinalPropsSelector</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> ownProps</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">mergeProps</span><span class="token punctuation">(</span>
      <span class="token function">mapStateToProps</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> ownProps<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">mapDispatchToProps</span><span class="token punctuation">(</span>dispatch<span class="token punctuation">,</span> ownProps<span class="token punctuation">)</span><span class="token punctuation">,</span>
      ownProps
    <span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我省略了大部分优化代码，很直观的理解就是过滤、合并最终你想要的 <code>props</code> 。剩下关于源码中 Hook 即是一些简单的封装，这里就不做解读了，很简单，如果感兴趣的话，请移步至 Github 仓库查看，那么这次的 React Redux 源码学习到此，感谢阅读至此！</p>

                </div>
            </div>

            
            <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者: </strong>
    Zong
  </li>
  <li class="post-copyright-link">
    <strong>本文链接: </strong>
    <a href="https://zongzi531.com/2020/03/23/react-redux%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/" title="React Redux 源码学习">https://zongzi531.com/2020/03/23/react-redux%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明: </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

            
    
            <nav class="post-pagination">
    
    <a class="newer-posts" href="/2020/04/02/%E5%8A%A0%E5%85%A5%E4%BD%93%E9%AA%8C%E6%8A%80%E6%9C%AF%E9%83%A8/">
        上一篇<br>加入体验技术部
    </a>
    
    <span class="page-number"></span>
    
    <a class="older-posts" href="/2020/03/20/redux%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/">
        下一篇<br>Redux 源码学习
    </a>
    
</nav>

    
            

<div class="post-comment-wrapper">
    <div class="giscus"></div>
</div>


        </div>
    </div>
    <div class="single-column-footer">
    <div style="margin-bottom: 8px;">
        <a title="GitHub" target="_blank" rel="noopener" href="https://github.com/zongzi531" style="margin: 0px 2px;"><svg height="16" width="16" viewBox="0 0 16 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg></a>
        <a title="知乎" target="_blank" rel="noopener" href="https://www.zhihu.com/people/zongzi531/posts" style="margin: 0px 2px;"><img height="16" src="https://static.zhihu.com/static/favicon.ico"></a>
        <a title="掘金" target="_blank" rel="noopener" href="https://juejin.im/user/58747cf2ac502e00646e3b8b/posts" style="margin: 0px 2px;"><img height="16" src="https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web//static/favicons/favicon-32x32.png"></a>
        <a title="力扣" target="_blank" rel="noopener" href="https://leetcode-cn.com/u/zongzi0531/" style="margin: 0px 2px;"><img height="16" src="https://static.leetcode-cn.com/cn-assets/icons/favicon-32x32.png"></a>
    </div>
    &copy; 2017 - 2024 <a href="https://zongzi531.com">Zong</a>
</div>
</div>

</div>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.4/dist/umd/popper.min.js"
        integrity="sha256-EGs9T1xMHdvM1geM8jPpoo8EZ1V1VRsmcJz8OByENLA=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
        integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.min.js"
        integrity="sha256-FtWfRI+thWlNz2sB3SJbwKx5PgMyKIVgwHCTwa3biXc=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/smooth-scroll@14.2.1/dist/smooth-scroll.polyfills.min.js"
        integrity="sha256-CI4Gq5E0io1Pv0xM3qPM+NUIOhbIBvC3GiN1Y4KhXpw=" crossorigin="anonymous"></script>
<script src="/js/journal.js?22856950"></script>


    <script src="https://giscus.app/client.js"
    data-repo="zongzi531/zongzi531.github.io"
    data-repo-id="MDEwOlJlcG9zaXRvcnkyMTgyODY2MjA="
    data-category="General"
    data-category-id="DIC_kwDODQLKHM4COlHH"
    data-mapping="url"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="zh-CN"
    data-loading="lazy"
    crossorigin="anonymous"
    async>
</script>


</body>
</html>
