---
title: RAG ç”Ÿæ€æ¢ç´¢
date: 2024-09-01 09:19:39
categories: "Blog"
comments: true
featured_image: pic-1.jpg
tags:
- Blog
- RAG
- GraphRAG
- Fine-tuning
- Ragas
---

<!-- no node -->

<!-- more -->

åœ¨å¯¹ RAG æœ‰äº†ç®€å•è®¤è¯†ä¹‹åï¼ŒåŸºäºä¸€äº›ä¸šåŠ¡çš„åœºæ™¯ï¼Œå¯¹ RAG ç”Ÿæ€è¿›è¡Œäº†ä¸€äº›æ¢ç´¢ã€‚

ç½‘ä¸Šæœ‰ä¸€å¼  RAG ç”Ÿæ€çš„æ¦‚æ‹¬å›¾ï¼Œæˆ‘è®¤ä¸ºä¸é”™ã€‚

![rag-ecosystem](./rag-eco.png)

## å›¾è°±

åœ¨ RAG å·¥ä½œæµä¸­ï¼Œè€ƒè™‘é€šè¿‡å›¾è°±çš„æ¦‚å¿µï¼Œç”Ÿæˆæ›´å…¨é¢çš„ä¸€äº›ä¿¡æ¯ä»¥æå‡é—®ç­”çš„åŠŸèƒ½ã€‚

å°è¯•å¾®è½¯å¼€æºçš„ GraphRAG å¯¹æ–‡æœ¬ï¼ˆå¤§æ–‡æœ¬ã€å¤šæ–‡æœ¬ï¼‰æå–å®ä½“ã€å…³ç³»ï¼Œä»¥åœ¨é—®ç­”ç¯èŠ‚å¯ä»¥å°è¯•ä¸€äº›é€»è¾‘æˆ–è€…æ€»ç»“æ€§çš„è·¯ç”±æµç¨‹ã€‚

å›¾è°±ç›¸è¾ƒäºåˆ‡ç‰‡ï¼Œå…·æœ‰æ›´å¼ºçš„é€»è¾‘æ€§ï¼Œå¹¶ä¸”ä¿¡æ¯é“¾æ›´ä¸ºæ¸…æ™°ï¼Œè€Œåˆ‡ç‰‡å´æœ‰å†—ä½™ä»¥åŠæ— æ³•å¤šå†…å®¹å…³è”çš„é—®é¢˜ã€‚

å½“ç„¶äº†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ”¯æŒå¤§ tokens çš„ LLM è¿›è¡Œæ€»ç»“æˆ–å…¶ä»–åŠ¨ä½œï¼Œåªä¸è¿‡è¿™æ ·ä¼šé‡å¤çš„æ¶ˆè€—å¤§ tokens ï¼Œä»èµ„æºå±‚é¢æ˜¯æµªè´¹çš„ã€‚

ä»¥ä¸‹æ˜¯ GraphRAG ç´¢å¼•æ­¥éª¤ï¼š

```bash
â ‹ GraphRAG Indexer 
â”œâ”€â”€ Loading Input (text)
â”œâ”€â”€ create_base_text_units
â”œâ”€â”€ create_base_extracted_entities
â”œâ”€â”€ create_final_covariates
â”œâ”€â”€ create_summarized_entities
â”œâ”€â”€ join_text_units_to_covariate_ids
â”œâ”€â”€ create_base_entity_graph
â”œâ”€â”€ create_final_entities
â”œâ”€â”€ create_final_nodes
â”œâ”€â”€ create_final_communities
â”œâ”€â”€ join_text_units_to_entity_ids
â”œâ”€â”€ create_final_relationships
â”œâ”€â”€ join_text_units_to_relationship_ids
â”œâ”€â”€ create_final_community_reports
â”œâ”€â”€ create_final_text_units
â”œâ”€â”€ create_base_documents
â””â”€â”€ create_final_documents
ğŸš€ All workflows completed successfully.
```

ç›®å‰ï¼Œ GraphRAG å¯¹ä¸åŒç±»å‹çš„æ–‡æ¡£è¿›è¡Œç´¢å¼•æ—¶ï¼Œéœ€è¦äººä¸ºä¸ºå·¥å…·æä¾›å®ä½“ç±»å‹ï¼ˆè€ƒè™‘æ˜¯ä¸æ˜¯èƒ½ç”± LLM ä»£æ›¿ï¼‰ï¼Œä»¥åœ¨ç´¢å¼•æ—¶èƒ½å¤Ÿæ›´å¥½çš„åˆ†ææå–å®ä½“å’Œå…¶ä¹‹é—´çš„å…³ç³»ã€‚

æ‰€ä»¥å¦‚æœéœ€è¦æ¥å…¥åˆ°ç°æœ‰çš„ RAG æµç¨‹ï¼Œéœ€è¦ Python ç¼–ç¨‹è°ƒæ•´å„èŠ‚ç‚¹é€»è¾‘ï¼Œä»¥é€‚é… RAG æµç¨‹ã€‚

è§†è§‰æ•ˆæœï¼š

![graph_example](https://github.com/zongzi531/modular-rag/blob/main/index/graphrag/images/graph_example.png?raw=true)

> è¯¦ç»†å¯[æŸ¥çœ‹](https://github.com/zongzi531/modular-rag/blob/main/index/graphrag/README.md)

## å¾®è°ƒ Embeddings æ¨¡å‹å°è¯•

ä½¿ç”¨ `uniem` å·¥å…·å¯¹æ¨¡å‹è¿›è¡Œå¾®è°ƒï¼Œåˆ†åˆ«å°è¯•è¿‡å¯¹ `small` ã€ `base` ã€ `large` è¿›è¡Œä¸åŒçš„å¾®è°ƒå¯¹æ¯”ï¼Œå¯èƒ½æ˜¯æ•°æ®é›†é€‰ç”¨çš„å…³ç³»ï¼Œæ•ˆæœå¹¶ä¸æ˜¯ç‰¹åˆ«ç†æƒ³ï¼Œå¹¶ä¸”åœ¨å¤§æ•°æ®é›†çš„å¾®è°ƒåœºæ™¯ä¸‹ï¼Œå¾®è°ƒæ—¶é—´è¾ƒé•¿ï¼Œæˆæœ¬è¾ƒå¤§ï¼Œæ‰€ä»¥æš‚ç¼“ã€‚

æœ€åç›´æ¥é€‰ç”¨ `bge-large-zh-v1.5` ä¸ºæœ¬åœ° Embeddings æ¨¡å‹ã€‚

## è¯„æµ‹

ä½¿ç”¨ Ragas å·¥å…·è¿›è¡Œ RAG æµç¨‹è¯„æµ‹ã€‚åœ¨ä½¿ç”¨æ­¤å·¥å…·å‰ï¼Œé‡‡ç”¨äººå·¥æµ‹è¯•é›†è¿›è¡Œè¯„æµ‹ï¼Œå¹¶ä¸”è¯„æµ‹ç»´åº¦è¾ƒä¸ºä¸»è§‚ã€‚

éœ€è¦æ³¨æ„ âš ï¸ ï¼šåœ¨æµ‹è¯•é›†ç”Ÿæˆå’Œè¯„æµ‹é˜¶æ®µï¼Œä¼šå¤§é‡æ¶ˆè€— LLM tokens ï¼Œè¯·åˆç†é€‰æ‹©éœ€è¦è¯„æµ‹æŒ‡æ ‡ã€‚

### è¯„æµ‹æŒ‡æ ‡

| æŒ‡æ ‡åç§° | èŒƒå›´ | å«ä¹‰ |
| --- | --- | --- |
| `context_precision` ä¸Šä¸‹æ–‡ç²¾åº¦ | (0,1) | å€¼è¶Šå¤§ï¼Œè¡¨ç¤º `ground_truth` ä¸ `contexts` è¶Šç›¸å…³ã€‚ |
| `faithfulness` å¿ è¯šåº¦/å¯ä¿¡åº¦ | (0,1) | ç”± `answer` ä¸ `contexts` è®¡ç®—å¾—å‡ºï¼Œå€¼è¶Šå¤§ï¼Œè¡¨ç¤º `answer` æ›´å¯ä¿¡ã€‚ |
| `answer_relevancy` ç­”æ¡ˆç›¸å…³æ€§ | (-1,1) | ç”± `answer` ã€ `contexts` ä¸ `question` è®¡ç®—å¾—å‡ºï¼Œå€¼è¶Šå¤§ï¼Œè¡¨ç¤º `answer` çš„ç›¸å…³æ€§è¾ƒå¥½ã€‚ |
| `context_recall` ä¸Šä¸‹æ–‡å¬å› | (0,1) | é€šè¿‡å¯¹ `ground_truth` è¿›è¡Œåˆ†è§£ä»¥éªŒè¯æ˜¯å¦å¯ä»¥å½’å› äº `contexts` ï¼Œå€¼è¶Šå¤§ï¼Œè¡¨ç¤ºæ€§èƒ½è¶Šå¥½ï¼ˆé¿å…åå¤å°è¯•ï¼‰ã€‚ |
| `context_entity_recall` ä¸Šä¸‹æ–‡å®ä½“å¬å› | (0,1) | åˆ†åˆ«è®¡ç®— `ground_truth` å’Œ `contexts` çš„å®ä½“ï¼Œä½¿ç”¨å…¶å®ä½“è¿›è¡Œå¬å›ï¼Œå€¼è¶Šå¤§ï¼Œè¡¨ç¤ºæ€§èƒ½è¶Šå¥½ï¼ˆé¿å…åå¤å°è¯•ï¼‰ã€‚ |
| `answer_similarity` ç­”æ¡ˆè¯­ä¹‰ç›¸ä¼¼åº¦ | (0,1) | ç”± `answer` ä¸ `ground_truth` è®¡ç®—å¾—å‡ºï¼Œå€¼è¶Šå¤§ï¼Œè¡¨ç¤º `answer` ä¸ `ground_truth` æ›´ç›¸ä¼¼ã€‚ |
| `answer_correctness` ç­”æ¡ˆæ­£ç¡®æ€§ | (0,1) | ç”± `answer` ä¸ `ground_truth` è®¡ç®—å¾—å‡ºï¼Œå€¼è¶Šå¤§ï¼Œè¡¨ç¤º `answer` ä¸ `ground_truth` ä¸€è‡´æ€§è¶Šé«˜ã€‚ |
| `AspectCritique` æ–¹é¢æ‰¹è¯„ | - | ç”¨äºè¯„æµ‹ `answer` çš„å†…å®¹æ˜¯å¦åŒ…å«è¯„æµ‹ã€Œæ–¹é¢ã€çš„å†…å®¹ï¼Œå¦‚æœ‰å®³æ€§ã€æ¶æ„æ€§ã€è¿è´¯æ€§ã€æ­£ç¡®æ€§ã€ç®€æ´æ€§ |
| `summarization_score` æ€»ç»“åˆ†æ•° | - | - |

---

æ‰€ä»¥åœ¨ä¸è€ƒè™‘ LLM tokens çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ©ç”¨è‡ªåŠ¨åŒ–è¯„æµ‹å·¥å…·æ¥ä¼˜åŒ–ç°åœ¨æœ‰çš„ RAG åº”ç”¨ï¼Œä¸é™äº RAG æµç¨‹ã€Prompt å·¥ç¨‹ç­‰ï¼Œç›¸è¾ƒäºäººå·¥æµ‹è¯•é›†ï¼Œå¯ä»¥è¯´æ•ˆç‡å¤§å¤§æå‡ã€‚

> è¯¦ç»†å¯[æŸ¥çœ‹](https://github.com/zongzi531/modular-rag/tree/main/evaluation/ragas)
