









<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            <div class="post-head-wrapper-text-only"
                 style="background-image: url('')">
                <div class="post-title">
                    关于Vue父子组件通信遇到的小插曲
                    <div class="post-meta">
                        <time datetime="2018-02-12T19:12:28.000Z" itemprop="datePublished">
                            2018-02-12 19:12
                        </time>&nbsp;
                        
                        
                        <i class="material-icons" style="">folder</i>
                        
                        <a href='/categories/Vue/'>Vue</a>
                        
                        
    
                        
                        
                        <i class="material-icons" style="">label</i>
                        
                        <a href='/tags/Vue/'>Vue</a>
                        
                        
                    </div>
                </div>
            </div>
    
            <div class="post-body-wrapper">
                <div class="post-body">
                    <!-- no node -->

<span id="more"></span>

<p>近期，从React重新回到Vue开发，那么选择了UI组件库Vux，那么简单来说一下遇到的问题吧。</p>
<p>使用到XDialog组件，可以说Vux已经将这个组件封装的很好使用了，但是我就是想把他根据项目的业务情况再封装一遍，那么有趣的是，<code>v-model</code>的值是又<code>props</code>传入的，文档中提供的方法有限，并且我需要使用到<code>hide-on-blur</code>属性。</p>
<p>然后控制台就报错了：</p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token punctuation">[</span>Vue warn<span class="token punctuation">]</span><span class="token punctuation">:</span> Avoid mutating a prop directly since the value will be overwritten whenever the parent component re<span class="token operator">-</span>renders<span class="token punctuation">.</span> Instead<span class="token punctuation">,</span> use a data or computed property based on the prop's value<span class="token punctuation">.</span> Prop being mutated<span class="token punctuation">:</span> <span class="token string">"..."</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>当时我就愣住了，很难受吧！好的，再次逼着我去读源码，真的很OJBK。</p>
<p>当我看到<code>hide</code>方法的时候我意外的惊喜：</p>
<pre class="line-numbers language-javascript"><code class="language-javascript">hide <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>hideOnBlur<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'update:show'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'on-click-mask'</span><span class="token punctuation">)</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我发现了一个隐藏的事件监听器可以用，<code>@on-click-mask</code>，但是很遗憾的是，在执行这个事件之前，<code>v-model</code>的值就被修改了！</p>
<p>那么很抱歉，我放弃了这个想法，查阅了一下网上的资料，找到了一丝灵感。</p>
<p>代码最终实现如下：</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-transfer-dom</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-dialog</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>currentShow<span class="token punctuation">"</span></span> <span class="token attr-name">:hide-on-blur</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-dialog</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">import</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> XDialog<span class="token punctuation">,</span> TransferDomDirective <span class="token keyword">as</span> TransferDom <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">from</span> <span class="token string">'vux'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  props<span class="token punctuation">:</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    show<span class="token punctuation">:</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      type<span class="token punctuation">:</span> Boolean<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
  computed<span class="token punctuation">:</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    currentShow<span class="token punctuation">:</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      <span class="token keyword">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>show
      <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
      <span class="token keyword">set</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'on-Click-hide'</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span>
      <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
  directives<span class="token punctuation">:</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    TransferDom
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
  components<span class="token punctuation">:</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    XDialog
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>确实需要<code>props</code>传入<code>show</code>，但是绑定在<code>v-model</code>上的却不能是<code>show</code>，不然就会有上面那个报错，而是自定义一个计算属性，并设置他的<code>get</code>和<code>set</code>方法。</p>
<p>我们修改了原有的<code>set</code>方法，将其以一个事件监听器的形式传递至外层，由外层控制<code>props</code>的值即可。OJBK，问题解决了。</p>
<p>其实后续可以回想，我其实可以简单的只封装XDialog中的slot内容即可，别问我为什么要把XDialog也封装进去，没有为什么，就是喜欢。</p>
<p>再回想我解决问题的思路：</p>
<ol start="0">
<li>呀！报错了</li>
<li>先搞清楚问题出在哪儿</li>
<li>试着从源码找突破口</li>
<li>各种搜各种试</li>
<li>狗屎运，问题给我解决了</li>
<li>然后看心情记一笔</li>
</ol>
<hr>
<blockquote>
<p>扯一扯环节</p>
</blockquote>
<p>说到试着从源码找突破口，我就想起使用Element @1.4.10版本的时候，因为使用到vuex，所以修改数据要显示的提交<code>commit</code>，由于库提供的方法是直接清空表单数据的，会限制我使用vuex。</p>
<p>如果我手动提交commit方法，表单上的验证信息并不会清除。那么我就开始读源码了……，然后在源码中找到了惊喜！解决了我的需求。</p>
<p>解决方法：<a href="http://zongzi531.com/2017/11/25/%E8%BF%9B%E9%98%B6es6%E4%BA%8C/">5.1 element-ui 清空所有表单项的验证信息</a></p>
<p>马上要过新年了，提前祝大家新年快乐哦！</p>

                </div>
            </div>

            
            
            
    
            
    
            
        </div>
    </div>
    
</div>






