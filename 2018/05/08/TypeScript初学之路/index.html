









<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            <div class="post-head-wrapper-text-only"
                 style="background-image: url('')">
                <div class="post-title">
                    TypeScript 初学之路
                    <div class="post-meta">
                        <time datetime="2018-05-08T18:56:44.000Z" itemprop="datePublished">
                            2018-05-08 18:56
                        </time>&nbsp;
                        
                        
                        <i class="material-icons" style="">folder</i>
                        
                        <a href='/categories/TypeScript/'>TypeScript</a>
                        
                        
    
                        
                        
                        <i class="material-icons" style="">label</i>
                        
                        <a href='/tags/TypeScript/'>TypeScript</a>
                        
                        
                    </div>
                </div>
            </div>
    
            <div class="post-body-wrapper">
                <div class="post-body">
                    <!-- no node -->

<span id="more"></span>

<blockquote>
<p>To Do List一直是我学习框架开始的地方，最早写To Do List这个demo是在初学Vue的时候。<br>时间过得很快，在我学习React的时候，我直接将这个Vue demo进行了改写。<br>现在我重新将这个demo从JavaScript改写成TypeScript，在此分享一些学习总结。</p>
</blockquote>
<p>此次，仍然使用create-react-app脚手架创建React项目，按照TypeScript官网推荐，你可以使用以下命令完成项目创建。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># Install create-react-app</span>
$ <span class="token function">npm</span> <span class="token function">install</span> -g create-react-app

<span class="token comment" spellcheck="true"># Create our new project</span>
$ create-react-app my-app --scripts-version<span class="token operator">=</span>react-scripts-ts
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>更多详细操作可以参见<a target="_blank" rel="noopener" href="https://github.com/Microsoft/TypeScript-React-Starter">TypeScript-React-Starter</a>。</p>
<h2 id="泛型参数"><a href="#泛型参数" class="headerlink" title="泛型参数"></a>泛型参数</h2><p>泛型参数类型是用来约束类的成员/方法参数类型。</p>
<pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Component</span><span class="token operator">&lt;</span>P <span class="token operator">=</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> S <span class="token operator">=</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> SS <span class="token operator">=</span> <span class="token keyword">any</span><span class="token operator">></span> <span class="token keyword">extends</span> <span class="token class-name">ComponentLifecycle</span><span class="token operator">&lt;</span>P<span class="token punctuation">,</span> S<span class="token punctuation">,</span> SS<span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Component</span><span class="token operator">&lt;</span>P<span class="token punctuation">,</span> S<span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">:</span> P<span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token keyword">any</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// We MUST keep setState() as a unified signature because it allows proper checking of the method return type.</span>
    <span class="token comment" spellcheck="true">// See: https://github.com/DefinitelyTyped/DefinitelyTyped/issues/18365#issuecomment-351013257</span>
    <span class="token comment" spellcheck="true">// Also, the ` | S` allows intellisense to not be dumbisense</span>
    setState<span class="token operator">&lt;</span>K <span class="token keyword">extends</span> <span class="token class-name">keyof</span> S<span class="token operator">></span><span class="token punctuation">(</span>
        state<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>prevState<span class="token punctuation">:</span> Readonly<span class="token operator">&lt;</span>S<span class="token operator">></span><span class="token punctuation">,</span> props<span class="token punctuation">:</span> P<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>Pick<span class="token operator">&lt;</span>S<span class="token punctuation">,</span> K<span class="token operator">></span> <span class="token operator">|</span> S <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>Pick<span class="token operator">&lt;</span>S<span class="token punctuation">,</span> K<span class="token operator">></span> <span class="token operator">|</span> S <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        callback<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">void</span>
    <span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>

    <span class="token function">forceUpdate</span><span class="token punctuation">(</span>callBack<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> ReactNode<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// React.Props&lt;T> is now deprecated, which means that the `children`</span>
    <span class="token comment" spellcheck="true">// property is not available on `P` by default, even though you can</span>
    <span class="token comment" spellcheck="true">// always pass children as variadic arguments to `createElement`.</span>
    <span class="token comment" spellcheck="true">// In the future, if we can define its call signature conditionally</span>
    <span class="token comment" spellcheck="true">// on the existence of `children` in `P`, then we should remove this.</span>
    props<span class="token punctuation">:</span> Readonly<span class="token operator">&lt;</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> children<span class="token operator">?</span><span class="token punctuation">:</span> ReactNode <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">></span> <span class="token operator">&amp;</span> Readonly<span class="token operator">&lt;</span>P<span class="token operator">></span><span class="token punctuation">;</span>
    state<span class="token punctuation">:</span> Readonly<span class="token operator">&lt;</span>S<span class="token operator">></span><span class="token punctuation">;</span>
    context<span class="token punctuation">:</span> <span class="token keyword">any</span><span class="token punctuation">;</span>
    refs<span class="token punctuation">:</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>key<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">]</span><span class="token punctuation">:</span> ReactInstance
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>查看<code>Component</code>源码你会发现泛型参数<code>P</code>对应的就是<code>props</code>，泛型参数<code>S</code>对应的就是<code>state</code>。</p>
<p>所以在写<code>class</code>组件时，都会以以下格式进行定义：</p>
<pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token operator">&lt;</span>IPropTypes<span class="token punctuation">,</span> IStateTypes<span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p>来回顾一下，之前我们写React会使用<code>prop-types</code>来约束<code>props</code>的参数类型，但是现在我们可以放弃他，尽情发挥TypeScript的类型检查功能。</p>
<p>我们可以使用接口来约束<code>props</code>的类型，这同样也受用于<code>state</code>。</p>
<p>同样在写组件时，你会发现通用组件下会存在可选参数，那么写接口时就会使用到可选属性来解决这个问题。那么如果某些组件没有可选属性时候，你就不需要再使用<code>defaultProps</code>来设置<code>props</code>的默认值了，因为TypeScript的类型会直接抛出错误。</p>
<p>接口也提供导出导入功能，方便我们在开发的时候共用接口或者继承接口。</p>
<h2 id="基础类型"><a href="#基础类型" class="headerlink" title="基础类型"></a>基础类型</h2><p>期初我在定义数据类型的时候，不确定的我都会定义成<code>any</code>，当然我知道这很不优雅，也不是我的代码风格，所以我不会就此罢休。</p>
<p>我尝试着去把所有的不确定都换成确定。想想如果将所有的数据类型都定义成<code>any</code>，那么就失去了TypeScript的类型检查功能了，非常糟糕。</p>
<p>所以我在写泛型参数<code>props</code>和<code>state</code>时，如果存在没有属性的情况下，我会选择使用空对象类型<code>&#123;&#125;</code>，使得我的程序更可控。</p>
<h2 id="事件类型"><a href="#事件类型" class="headerlink" title="事件类型"></a>事件类型</h2><p>在写到表单内容时，会有一些需要使用到<code>event</code>的地方，这次我使用了React提供的事件类型。</p>
<pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">SyntheticEvent</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    bubbles<span class="token punctuation">:</span> <span class="token keyword">boolean</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">/**
     * A reference to the element on which the event listener is registered.
     */</span>
    currentTarget<span class="token punctuation">:</span> EventTarget <span class="token operator">&amp;</span> T<span class="token punctuation">;</span>
    cancelable<span class="token punctuation">:</span> <span class="token keyword">boolean</span><span class="token punctuation">;</span>
    defaultPrevented<span class="token punctuation">:</span> <span class="token keyword">boolean</span><span class="token punctuation">;</span>
    eventPhase<span class="token punctuation">:</span> <span class="token keyword">number</span><span class="token punctuation">;</span>
    isTrusted<span class="token punctuation">:</span> <span class="token keyword">boolean</span><span class="token punctuation">;</span>
    nativeEvent<span class="token punctuation">:</span> Event<span class="token punctuation">;</span>
    <span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">isDefaultPrevented</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">boolean</span><span class="token punctuation">;</span>
    <span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">isPropagationStopped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">boolean</span><span class="token punctuation">;</span>
    <span class="token function">persist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// If you thought this should be `EventTarget &amp; T`, see https://github.com/DefinitelyTyped/DefinitelyTyped/pull/12239</span>
    <span class="token comment" spellcheck="true">/**
     * A reference to the element from which the event was originally dispatched.
     * This might be a child element to the element on which the event listener is registered.
     *
     * @see currentTarget
     */</span>
    target<span class="token punctuation">:</span> EventTarget<span class="token punctuation">;</span>
    timeStamp<span class="token punctuation">:</span> <span class="token keyword">number</span><span class="token punctuation">;</span>
    type<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上是<code>SyntheticEvent&lt;T&gt;</code>接口源码，React已经将原生事件需要部分进行了合成，在此基础上有更细化的接口：<code>FocusEvent&lt;T&gt;</code>、<code>ChangeEvent&lt;T&gt;</code>、<code>KeyboardEvent&lt;T&gt;</code>。</p>
<p>这里必须要很强势的安利一波VSCode，他让我的TypeScript开发体验变得如此之优雅，让我能够更好的学习TypeScript。</p>
<h2 id="TSLint"><a href="#TSLint" class="headerlink" title="TSLint"></a>TSLint</h2><p>代码舒适区这个问题，我选择适当的妥协，我选择适当的适应规则让我成长，而不是一味的寻找舒适区。</p>
<p>列举一下这个demo中我配置的TSLint：</p>
<ol>
<li><code>&quot;semicolon&quot;: [true, &quot;never&quot;]</code>：一如既往，我选择不写分号。</li>
<li><code>&quot;object-literal-sort-keys&quot;: false</code>：我关闭了短属性名提醒。</li>
<li><code>&quot;ordered-imports&quot;: false</code>：我关闭了<code>import</code>的约束，使我可以导入CSS文件。</li>
</ol>
<p>但是比如定义接口时必须以大写字母<code>I</code>打头的这类约束我并没有关闭，我认为这些是需要我去适应的。</p>
<h2 id="遇到的一些问题"><a href="#遇到的一些问题" class="headerlink" title="遇到的一些问题"></a>遇到的一些问题</h2><ol>
<li><p>Issues <a target="_blank" rel="noopener" href="https://github.com/DefinitelyTyped/DefinitelyTyped/issues/25342">Duplicate identifier with @types/node 10.0</a>。</p>
<p> 遇到此问题，之前我是将node版本降级至@types/<a href="mailto:&#x6e;&#x6f;&#100;&#101;&#64;&#57;&#46;&#x36;&#46;&#x37;">&#x6e;&#x6f;&#100;&#101;&#64;&#57;&#46;&#x36;&#46;&#x37;</a>，但是目前@types/<a href="mailto:&#x6e;&#111;&#100;&#x65;&#64;&#49;&#x30;&#x2e;&#48;&#x2e;&#x32;">&#x6e;&#111;&#100;&#x65;&#64;&#49;&#x30;&#x2e;&#48;&#x2e;&#x32;</a>已经修复该问题。</p>
</li>
<li><p>本demo会使用到react-dnd，但是使用TypeScript时，如果继续使用修饰器的写法，将无法继续进行下去。</p>
<p> 我查阅Issues后选择退而求其次，使用高阶组件写法来解决此问题。<br> 相关Issues：<a target="_blank" rel="noopener" href="https://github.com/react-dnd/react-dnd/issues/782">#782</a> <a target="_blank" rel="noopener" href="https://github.com/react-dnd/react-dnd/issues/785">#785</a></p>
</li>
</ol>
<hr>
<p>本文中提及源码版本：**@types/<a href="mailto:&#114;&#x65;&#97;&#99;&#116;&#x40;&#x31;&#54;&#x2e;&#51;&#46;&#49;&#51;">&#114;&#x65;&#97;&#99;&#116;&#x40;&#x31;&#54;&#x2e;&#51;&#46;&#49;&#51;</a>**</p>
<p>GitHub仓库： <a target="_blank" rel="noopener" href="https://github.com/zongzi531/react-to-do-list">zongzi531/react-to-do-list</a></p>

                </div>
            </div>

            
            
            
    
            
    
            
        </div>
    </div>
    
</div>






